(-> (unify (from :orders [{:o-custkey c}]) (from :lineitem [{:l-orderkey o, :l-suppkey s} l-shipdate l-discount l-extendedprice]) (where (>= l-shipdate #time/date "1995-01-01") (<= l-shipdate #time/date "1996-12-31")) (from :supplier [{:xt/id s, :s-nationkey n1}]) (from :nation [{:xt/id n1, :n-name supp-nation}]) (from :customer [{:xt/id c, :c-nationkey n2}]) (from :nation [{:xt/id n2, :n-name cust-nation}]) (where (or (and (= "FRANCE" supp-nation) (= "GERMANY" cust-nation)) (and (= "GERMANY" supp-nation) (= "FRANCE" cust-nation))))) (with {:l-year (extract "YEAR" l-shipdate)}) (aggregate supp-nation cust-nation l-year {:revenue (sum (* l-extendedprice (- 1 l-discount)))}) (order-by supp-nation cust-nation l-year))